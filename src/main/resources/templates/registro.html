<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.tymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:temporals="http://www.thymeleaf.org/extras/thymeleaf-temporals">


    <!--<meta http-equiv="refresh" content="10">-->

    <head th:replace="plantillas/plantilla::head">
        <title>Lista de tareas</title>
        <meta charset="UTF-8"/>
    </head>
    <body>
        <header th:replace="plantillas/plantilla::header">lista de tareas</header>

        <!--poner datatables o, si se complica, adaptar el filtro de abajo-->
<!--        <section  class="py-2 mb-4  bg-light">
            <form th:action="@{/filtrar}" method="post"   class="form-group">
                <div class="container">
                    <label  for="palabraClave">filtrar: </label>
                    <input type="text"  name="palabraClave" id="palabraClave" th:value="${palabraClave}"placeholder="digite valor a buscar" autocomplete="off"/>
                    <input th:type="submit"  th:value="buscar" class="btn btn-primary "/>
                </div>
            </form>
        </section>-->
        
        
        
        <div class="container ">
        <br/><h2>Registro histórico</h2><br/>
            <table class="table table-bordered table-hover table-sm "  >
                <thead class="thead-light " >
                    <tr > 
                        <th >activo</th>
                        <th >descripcion del problema</th>
                        <th >tiempo activo detenido</th>
                        <th >demora de cierre de solicitud</th>
                    </tr>
                </thead>
                <tbody >
                    <tr th:each="tarea: ${tareas}">

                        <td th:text="${tarea.activo.nombre}" >activo</td>
                        <td th:text="${tarea.descripcion}">descripcion</td>
                        <td th:id="tiempoDetenido+${tarea.idTarea}"></td>
                        <td th:id="tiempoCierre+${tarea.idTarea}"></td>
                        
                        
                <script th:inline="javascript">
                    
                        var detencion =  [[${tarea.momentoDetencion}]];
                        var liberacion = [[${tarea.momentoLiberacion}]];
                        var cierre = [[${tarea.momentoCierre}]];
                        var id =         [[${tarea.idTarea}]];
                        
                        // Obtener las fechas de momentoDetencion y momentoLiberacion
                        var momentoDetencion = new Date(detencion); // Convertir a formato ISO-8601
                        var momentoLiberacion = new Date(liberacion); // Convertir a formato ISO-8601
                        var momentoCierre = new Date(cierre); // Convertir a formato ISO-8601
                        // Calcular la diferencia de tiempo en milisegundos
                        
                        
                        var diferenciaMilisegundos = momentoLiberacion - momentoDetencion;

                        // Convertir la diferencia de tiempo a días, horas, minutos y segundos
                        var segundos = Math.floor(diferenciaMilisegundos / 1000);
                        var minutos = Math.floor(segundos / 60);
                        var horas = Math.floor(minutos / 60);
                        var dias = Math.floor(horas / 24);

                        // Calcular los valores restantes para horas, minutos y segundos
                        horas = horas % 24;
                        minutos = minutos % 60;
                        segundos = segundos % 60;

                        // Construir la cadena de texto con la diferencia de tiempo
                        var diferenciaTiempoDetencion =  horas + " horas, " + minutos + " minutos" ;

                        // Actualizar el contenido de la celda con el ID "diferenciaTiempo"
                        $("#tiempoDetenido"+id).text(diferenciaTiempoDetencion);
                        
                        
                         diferenciaMilisegundos=momentoCierre-momentoLiberacion;
                        
                        // Convertir la diferencia de tiempo a días, horas, minutos y segundos
                         segundos = Math.floor(diferenciaMilisegundos / 1000);
                         minutos = Math.floor(segundos / 60);
                         horas = Math.floor(minutos / 60);
                         dias = Math.floor(horas / 24);

                        // Calcular los valores restantes para horas, minutos y segundos
                        horas = horas % 24;
                        minutos = minutos % 60;
                        segundos = segundos % 60;

                        // Construir la cadena de texto con la diferencia de tiempo
                        var diferenciaTiempoCierre =  horas + " horas, " + minutos + " minutos" ;
    
                        $("#tiempoCierre"+id).text(diferenciaTiempoCierre);


                </script>



                    </tr>
                    
                    
                    
                    
                </tbody>
            </table>
        </div>
         <section  class="py-4 mb-4 bg-light">
            <div class="container">
                <div class="row">
                    <div class="col-md-2" >
                        <a th:href="@{/}" class="btn btn-primary btn-block">
                             Volver
                        </a>
                    </div>

                </div>
            </div>
        </section>




        <footer th:replace="plantillas/plantilla::footer"></footer>
    </body>
</html>
